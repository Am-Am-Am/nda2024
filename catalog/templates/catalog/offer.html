{% extends 'core/base.html' %}
{% load static %}
{% block title %}<title>{{ category.name }}</title>{% endblock %}
{% block header %}
    {{ form.media }} # Required for styling/js to make ckeditor5 work
{% endblock %}
{% block content %}

{% include 'catalog/components/banner.html' %}

{% include 'catalog/components/breadcrumbs.html' %}

<div class="d-flex flex-row flex-wrap" style="padding-left: 2rem; padding-right: 2rem">
    <div class="row row-cols-2">
        <div class="col-sm-5">
            <div class="selected-image" style="text-align: center">
                <img id="mainImage" src="{{ images.all.0 }}" style="width: 500px; height: 500px">
            </div>
            <div class="thumbnail-carousel carousel">
                <a class="carousel-control-prev" type="button" id="prevControl">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" type="button" id="nextControl">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
                <div class="thumbnails" style="margin: auto">
                    {% for image in images %}
                        <img src="{{ image }}" style="width: 150px; height: 150px" onclick="changeImage(this.src)">
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="col-sm-7">
            <div>
                <h1>{{ category.name }}</h1>
                <p>{{ category.description|safe }}</p>
            </div>
        </div>
    </div>
</div>

<div class="d-flex flex-row flex-wrap" style="margin-left: 10rem; margin-right: 10rem">
    <table class="table table-bordered table-sm my-5" style="border: 2px solid #3f96c9; box-shadow: 0 0 5px 0 #000000">
        <thead>
            <tr style="background: rgb(249, 249, 247);">
                <th scope="col" class="col-sm-1" style="text-align: center; border-right: 1px solid #a1a1a0">
                    <strong>Код</strong>
                </th>
                <th scope="col" class="col-sm-9" style="text-align: left; border-right: 1px solid #a1a1a0">
                    <strong>Описание</strong>
                </th>
                <th scope="col" class="col-sm-2">
                    Количество
                </th>
            </tr>
        </thead>
        <tbody class="table-group-divider">
        {% for offer in offers %}
            <tr>
                <td style="vertical-align: middle; text-align: center; border-top: 1px solid #a1a1a0; border-bottom: 1px solid #a1a1a0; border-right: 1px solid #a1a1a0;">
                    {{ offer.name }}
                </td>
                <td style="vertical-align: middle; text-align: left; border-top: 1px solid #a1a1a0; border-left: 1px solid #a1a1a0; border-right: 1px solid #a1a1a0;">
                    {{ offer.description}}
                </td>
                <td style="vertical-align: middle; text-align: left; border-top: 1px solid #a1a1a0; border-left: 1px solid #a1a1a0;">
                    <form action="{% url 'cart_add' offer_id=offer.pk %}" method='post'>
                        {% csrf_token %}
                        <div class="input-group" style="justify-content: space-evenly">
                            <input class="form-control" type="number" name="quantity" min="1" required="" id="id_quantity">
                            <button class="btn btn-primary" type="submit" value="">Add to cart</button>
                        </div>
                    </form>

                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<script>
    const thumbnails = document.querySelector('.thumbnails');
    const prevControl = document.getElementById('prevControl');
    const nextControl = document.getElementById('nextControl');
    const thumbnailsDivWidth = 600;
    const thumbnailWidth = 200;
    const thumbnailsWidth = thumbnailWidth * document.querySelectorAll('.thumbnails img').length
    const currentOffset = (thumbnailsDivWidth - thumbnailsWidth) / 2;


    function changeImage(src) {
        document.getElementById('mainImage').src = src;
    }

    function moveImagesLeft(){
        const thumbnailImages = document.querySelectorAll('.thumbnails img');
        const itemToRemove = thumbnailImages[0]
        thumbnails.appendChild(itemToRemove)
        itemToRemove.remove
    }

    function moveImagesRight(){
        const thumbnailImages = document.querySelectorAll('.thumbnails img');
        const itemToRemove = thumbnailImages[thumbnailImages.length - 1]
        const firstItem = thumbnailImages[0]
        thumbnails.insertBefore(itemToRemove, firstItem)
        itemToRemove.remove
    }

    function updateCarousel(direction) {
        if (direction === 'next') {
            moveImagesLeft()
        } else if (direction === 'prev') {
            moveImagesRight()
        }
    }

    thumbnails.style.transform = `translateX(${currentOffset}px)`;
    console.log('currentOffset', currentOffset)

    prevControl.addEventListener('click', () => updateCarousel('prev'));
    nextControl.addEventListener('click', () => updateCarousel('next'));
</script>

{% endblock %}
