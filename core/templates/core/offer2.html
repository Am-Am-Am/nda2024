{% extends 'core/base1.html' %}
{% load static %}
{% load thumbnail %}
{% load thumbnail cache %}
{% load static cache %}
{% block title %}
    <title>{{ product.title }}</title>
{% endblock %}

{% block metatag %}
  <meta name="keywords" content="{{product.keywords}}">
  <meta property="og:url" content="https://nda.ru{{ request.path }}">
  <meta property="og:title" content="{{product.title}}">
  <meta property="og:type" content="website">
  <meta property="og:description" content="{{product.description|striptags}}">
  <meta name="description" content="{{product.description|striptags}}">
{% endblock %}



{% block links %}
<link rel="stylesheet" type="text/css" href="{% static 'bootstrap/css/bootstrap.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'custom/css/custom.css' %}" />
<script src="{% static 'bootstrap/js/bootstrap.js' %}"></script>

<script src="https://www.google.com/recaptcha/api.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@glidejs/glide/dist/css/glide.core.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/@glidejs/glide/dist/glide.min.js"></script>
{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{% static 'css/styleOffer.css'%}" type="text/css">
<link rel="stylesheet" href="{% static 'css/styleCarousel.css'%}" type="text/css">

{% endblock %}

{% block content %}
<header style="height: 0px;">
    <!-- летающая шапка -->
    {% include 'core/components/flyingHeader.html' %}

    <!-- летающая шапка -->
</header>

<main class="main">
    <div class="container1">
        {% include 'core/components/breadcrumbs.html' %}
        {% cache 600 brand.pk product.pk %}
            <div class="brandBanner" style="background: linear-gradient(135deg, {{ brand.banner_color }}, white);">
                <div class="brandLogo">
                {% if brand.logo %}  
                        <img src="{{ brand.logo.url }}" alt="{{ brand.name }}" />
                        {% else %}
                            <img src="{% static 'images/noImage.jpg' %}" alt="Default logo" />  
                        {% endif %}
                </div>
                <div class="brandInfo">
                {% if brand %}
                    <h1>{{ brand.name }}</h1>
                    <h2>{{ product.name }}</h2>
                {% comment %} {% else %}
                    <h1>{{ category.name }}</h1> {% endcomment %}
                {% endif %}
                </div>
            </div>
        {% endcache %}
        <div class="product">
            <div class="productHead">
                <div class="productCarousel">
                    <div class="carouselWrapper">
                        <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-inner">
                                {% for image in images %}
                                    {% cache 600 image.pk %}
                                        {% thumbnail image.image '600x800' format="PNG" as im %}
                                            <div class="carousel-item {% if forloop.first %}active{% endif %}">
                                                <img src="{{ im.url }}" class="d-block" alt="Product Image">
                                            </div>
                                        {% endthumbnail %}
                                    {% endcache %}
                                {% endfor %}
                            </div>
                            {% if images|length > 1 %}
                                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon slick-prev1" aria-hidden="true" style="background-image: url('{% static "images/offer/left.svg"%}')" ></span>
                                    <span class="visually-hidden">Previous</span>
                                </button>
                                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                                    <span class="carousel-control-next-icon slick-next1" aria-hidden="true" style="background-image: url('{% static "images/offer/right.svg"%}')"></span>
                                    <span class="visually-hidden">Next</span>
                                </button>
                            {% endif %}
                        </div>
                    </div>
                    {% if images|length > 1 %}
                        <div class="tumbnailsWrapper">
                            <div class="carousel-indicators tumbnails-list">
                                {% for image in images %}
                                    {% cache 600 image.pk %}
                                        {% with forloop.counter0 as index %}
                                            {% thumbnail image.image '150x150' format="PNG" as im %}
                                                <div class="thumbnailContainer" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="{{index}}" {% if forloop.first %}class="active"{% endif %}>
                                                    <img src="{{ im.url }}" class="d-block  thumbnail-image" aria-label="Slide {{ index }}">
                                                </div>
                                            {% endthumbnail %}
                                        {% endwith %}
                                    {% endcache %}
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                </div>
                <div class="productTitle">
                    <div class="productTitleText">
                        <h3>{{brand}}</h3>
                        <h2>{{ product.name }}</h2>
                        {{ product.description|safe }}
                    
                    </div>
                    <div class="productTitleConnect">
                        <div class="linkText">
                            Связаться со специалистом по продукции {{brand}} {{specialist.name}}:
                        </div>
                        <div class="linkContacts">
                            <a href="tel:{{specialist.phone}}" aria-label="Позвонить специалисту по номеру {{specialist.phone}}">
                                <div class="linkContactsEl">
                                    <img src="{% static "images/productCall.svg" %}" alt="Иконка телефона">
                                    <div>{{specialist.phone}}</div>
                                </div>
                            </a>
                            <a href="mailto:{{specialist.email}}" aria-label="Написать специалисту на почту {{specialist.email}}">
                                <div class="linkContactsEl">
                                    <img src="{% static "images/productMail.svg" %}" alt="Иконка электронной почты">
                                    <div>{{specialist.email}}</div>
                                </div>
                            </a>
                        </div>
                        {{vk_link}}
                    </div>
                </div>
            </div>
            <div class="productInfo">
                <div class="productInfoChoice">
                    <ul class="nav nav-pills" id="pills-tab" role="tablist">
                        <li {% if not video_file and not youtube_link and not rt_link and product.characteristics %} style="width: 25%;"{% endif %} 
                            {% if not video_file and not youtube_link and not rt_link and not product.characteristics %} style="width: 33.3%;"{% endif %}
                            {% if video_file or youtube_link or rt_link and not product.characteristics %} style="width: 25%;"{% endif %} 
                        class="nav-item" role="presentation">
                            <button class="nav-link first active" id="pills-description-tab" data-bs-toggle="pill"
                                data-bs-target="#pills-description" type="button" role="tab"
                                aria-controls="pills-description" aria-selected="true">Описание</button>
                        </li>
                        {% if product.characteristics %}
                        <li {% if not video_file and not youtube_link and not rt_link %} style="width: 25%;"{% endif %} class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-characteristics-tab" data-bs-toggle="pill"
                                data-bs-target="#pills-characteristics" type="button" role="tab"
                                aria-controls="pills-characteristics" aria-selected="false">Характеристики</button>
                        </li>
                        {% endif%}
                        <li {% if not video_file and not youtube_link and not rt_link and product.characteristics %} style="width: 25%;"{% endif %} 
                            {% if not video_file and not youtube_link and not rt_link and not product.characteristics%} style="width: 33.3%;"{% endif %}
                            {% if video_file or youtube_link or rt_link and not product.characteristics %} style="width: 25%;"{% endif %} 
                        class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-order-tab" data-bs-toggle="pill"
                                data-bs-target="#pills-order" type="button" role="tab" aria-controls="pills-order"
                                aria-selected="false">Оформить заказ</button>
                        </li>
                        <li {% if not video_file and not youtube_link and not rt_link and product.characteristics %} style="width: 25%;"{% endif %} 
                            {% if not video_file and not youtube_link and not rt_link and not product.characteristics%} style="width: 33.4%;"{% endif %}
                            {% if video_file or youtube_link or rt_link and not product.characteristics %} style="width: 25%;"{% endif %} 
                        class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-catalogs-tab" data-bs-toggle="pill"
                                data-bs-target="#pills-catalogs" type="button" role="tab" aria-controls="pills-catalogs"
                                aria-selected="false">Каталоги и РУ</button>
                        </li>
                        {% if video_file or youtube_link or rt_link %}
                        <li {% if not product.characteristics %} style="width: 25%;"{% endif %} 
                        class="nav-item" role="presentation">
                            <button class="nav-link last" id="pills-video-tab" data-bs-toggle="pill"
                                data-bs-target="#pills-video" type="button" role="tab" aria-controls="pills-video"
                                aria-selected="false">Видео</button>
                        </li>
                        {% endif%}
                    </ul>
                </div>
                <div class="tab-content productTabContent" id="pills-tabContent">
                    <!-- Описание товара/услуги -->
                    <div class="tab-pane fade show active" id="pills-description" role="tabpanel"
                        aria-labelledby="pills-description-tab">
                        <div class="productDescription">
                            {{ product.full_description|safe }}
                        </div>
                    </div>
                    <div class="tab-pane fade" id="pills-characteristics" role="tabpanel"
                        aria-labelledby="pills-characteristics-tab">
                        <div class="productDescription characteristics_table" >
                            {{ product.characteristics|safe }}
                        </div>
                    </div>
                    <div class="tab-pane fade" id="pills-order" role="tabpanel" aria-labelledby="pills-order-tab">
                        <div class="placeOrder">
                            <form action=""></form>
                            <div class="container1">
                                <table class="table table-responsive table-borderless custom-table">
                                    <thead>
                                        <tr class="table-header">
                                            <th class="col-2 text-center">
                                                Код
                                            </th>
                                            <th class="col-8 text-start">
                                                Описание
                                            </th>
                                            <th class="col-1 text-center">
                                                Уп/шт.
                                            </th>
                                            <th class="col-3">
                                                Количество
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody class="">
                                        {% for offer in offers|dictsort:'place' %}
                                            {% if offer.status == 'PUBLISHED' %}
                                        <tr class="table-row">
                                            <td class="text-center align-middle">{{ offer.name | safe}}</td>
                                            <td class="text-start align-middle">{{ offer.text_description | safe}}</td>
                                            <td class="text-center align-middle">{{ offer.shipping_pack | safe}}</td>
                                            <td class="text-start">
                                                <div class="quantity-input">
                                                    <form hx-post="{% url 'cart_add' offer_id=offer.pk %}"
                                                        hx-target="#cart" hx-swap="outerHTML" style="width: 100%;">
                                                        <div class="offerCount">
                                                            <div class="inputCount">
                                                                <div class="inputCountBtn1"
                                                                    onclick="changeQuantity(event, this, -1)">-</div>
                                                                <input class="form-control" type="number"
                                                                    name="quantity" value="0" required=""
                                                                    id="id_quantity" min="1"/>
                                                                <div class="inputCountBtn2"
                                                                    onclick="changeQuantity(event, this, 1)">+</div>
                                                            </div>
                                                                <button class="btn btn-primary quantityFormBtn" id="addButton"type="submit"
                                                                value="">Добавить</button>
                                                        </div>
                                                    </form>
                                                </div>
                                            </td>
                                        </tr>
                                        {% endif %}
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            </form>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="pills-catalogs" role="tabpanel" aria-labelledby="pills-catalogs-tab">
                        <div class="catalogTutorial">
                            {% if instructions %}
                                {% for instruction in instructions %}
                                    <div class="catalogTutorialLink">
                                        <a href="{{ instruction.file.url }}">
                                            <div class="catalogTutorialEl">
                                                <div class="catalogTutorialElText">Скачать инструкцию: {{instruction.get_filename}}</div>
                                                <div class="catalogTutorialElImg"></div>
                                            </div>
                                        </a>
                                    </div>
                                {% endfor %}
                            {% endif %}
                            {% if certificates %}
                                {% for certificate in certificates %}
                                <div class="catalogTutorialLink">
                                    <a href="{{ certificate.file.url }}">
                                        <div class="catalogTutorialEl">
                                            <div class="catalogTutorialElText">Скачать сертификат {{certificate.get_filename}}</div>
                                            <div class="catalogTutorialElImg"></div>
                                        </div>
                                    </a>
                                </div>
                                {% endfor %}
                            {% endif %}
                            {% if catalogs %}
                                {% for catalog in catalogs %}
                                <div class="catalogTutorialLink">
                                    <a href="{{ catalog.file.url }}">
                                        <div class="catalogTutorialEl">
                                            <div class="catalogTutorialElText">Скачать Каталог {{catalog.get_filename}}</div>
                                            <div class="catalogTutorialElImg"></div>
                                        </div>
                                    </a>
                                </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                    {% if video_file or youtube_link or rt_link %}
                    <div class="tab-pane fade" id="pills-video" role="tabpanel" aria-labelledby="pills-video-tab">
                        <div class="productVideo">
                            <div class="productVideoContainer">
                                    {% if  video_file %}
                                        <!-- Локальное видео -->
                                        <video controls style="width:100%; height:100%">
                                            <source src="{{ video_file.url }}" type="video/mp4">
                                        </video>
                                    {% elif rt_link %}
                                        <!-- Видео с RuTube -->
                                        <iframe width="100%" height="100%" src="https://rutube.ru/play/embed/{{ rt_link|slice:'23:' }}" frameBorder="0" allow="clipboard-write; autoplay" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
                                    {% elif youtube_link %}
                                        <!-- Видео с Ютуб -->
                                        <iframe width="100%" height="100%" src="{{youtube_link}}" frameBorder="0" allow="clipboard-write; autoplay" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
                                    {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                 <div class="dropDown">
                    <details>
                        <summary>Описание</summary>
                        <div class="dropDownEl">
                            <div class="productDescription">
                                {{ product.full_description|safe }}
                            </div>
                        </div>
                    </details>
                    <details>
                        <summary>Характеристики</summary>
                        <div class="dropDownEl characteristics_table">
                            {{ product.characteristics|safe }}
                        </div>
                    </details>
                    <details>
                        <summary>Оформить заказ</summary>
                        <div class="dropDownEl">
                            <div class="placeOrder">
                                <form action=""></form>
                                <div class="container1">
                                    <table class="table table-responsive table-borderless">
                                        <thead>
                                            <tr class="table-header">
                                                <th class="col-3 text-center align-middle">
                                                    Код
                                                </th>
                                                <th class="col-6 text-center align-middle">
                                                    Описание
                                                </th>
                                                <th class="col-2 text-center align-middle">
                                                    Уп/шт.
                                                </th>
                                                <th class="col-5 text-center align-middle">
                                                    Количество
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody class="">
                                            {% for offer in offers|dictsort:'place'%}
                                            <tr class="table-row">
                                                <td class="text-center align-middle">{{ offer.name | safe}}</td>
                                                <td class="text-center align-middle">{{ offer.text_description | safe}}</td>
                                                <td class="text-center align-middle">{{ offer.shipping_pack | safe}}</td>
                                                <td class="text-center align-middle">
                                                    <div class="quantity-input">
                                                        <form hx-post="{% url 'cart_add' offer_id=offer.pk %}"
                                                            hx-target="#cart" hx-swap="outerHTML" style="width: 100%;">
                                                            <div class="offerCount">
                                                                <div class="inputCount">
                                                                    {% comment %} <div class="inputCountBtn1"
                                                                        onclick="changeQuantity(event, this, -1)">-</div> {% endcomment %}
                                                                    <input class="form-control" type="number"
                                                                        name="quantity" value="0" required=""
                                                                        id="id_quantity" min="1"/>
{% comment %}     
                                                                    <div class="inputCountBtn2"
                                                                        onclick="changeQuantity(event, this, 1)">+</div>
     {% endcomment %}
                                                                </div>
                                                                    <button class="btn btn-primary quantityFormBtn" id="addButton"type="submit"
                                                                    value="">Добавить</button>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                </form>
                            </div>
                        </div>
                    </details>
                    <details>
                        <summary>Каталоги и РУ</summary>
                        <div class="dropDownEl">
                            <div class="catalogTutorial">
                                {% if instructions %}
                                    {% for instruction in instructions %}
                                        <div class="catalogTutorialLink">
                                            <a href="{{ instruction.file.url }}">
                                                <div class="catalogTutorialEl">
                                                    <div class="catalogTutorialElText">Скачать инструкцию {{instruction.get_filename}}</div>
                                                    <div class="catalogTutorialElImg"></div>
                                                </div>
                                            </a>
                                        </div>
                                    {% endfor %}
                                {% endif %}
                                {% if certificates %}
                                    {% for certificate in certificates %}
                                    <div class="catalogTutorialLink">
                                        <a href="{{ certificate.flie.url }}">
                                            <div class="catalogTutorialEl">
                                                <div class="catalogTutorialElText">Скачать сертификат {{certificate.get_filename}}</div>
                                                <div class="catalogTutorialElImg"></div>
                                            </div>
                                        </a>
                                    </div>
                                    {% endfor %}
                                {% endif %}
                                {% if catalogs %}
                                    {% for catalog in catalogs %}
                                    <div class="catalogTutorialLink">
                                        <a href="{{ catalog.file.url }}">
                                            <div class="catalogTutorialEl">
                                                <div class="catalogTutorialElText">Скачать Каталог {{catalog.get_filename}}</div>
                                                <div class="catalogTutorialElImg"></div>
                                            </div>
                                        </a>
                                    </div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                    </details>
                    {% if video_file or youtube_link or rt_link %}
                    <details>
                        <summary>Видео</summary>
                        <div class="dropDownEl">
                            <div class="productVideo">
                                <div class="productVideoContainer">
                                        {% if  video_file %}
                                            <!-- Локальное видео -->
                                            <video controls style="width:100%; height:auto">
                                                <source src="{{ video_file.url }}" type="video/mp4">
                                            </video>
                                        {% elif rt_link %}
                                            <!-- Видео с RuTube -->
                                            <iframe width="100%" height="100%" src="https://rutube.ru/play/embed/{{ rt_link|slice:'23:' }}" frameBorder="0" allow="clipboard-write; autoplay" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
                                            <!-- Видео с Ютуб -->
                                            {% comment %} <iframe width="100%" height="100%" src="" frameBorder="0" allow="clipboard-write; autoplay" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe> {% endcomment %}
                                        {% endif %} 
                                </div>
                            </div>
                        </div>
                    </details>
                    {% endif %}
                 </div>   
                 {% include 'core/components/offer2ButtonCart.html' %}
            </div>
        </div>
        <!-- Placeholder for the modal -->
        <div id="modal" class="modal fade">
            <div id="dialog" class="modal-dialog modal-xl" hx-target="this" ></div>
        </div>
    </div>
    <!-- плавающий элемент с формами связи -->
    {% include 'core/components/formsContainer.html' %}

    <!-- плавающий элемент с формами связи -->
</main>
{% endblock %}

{% block script %}

<script src="{% static 'scripts/offers-htmx-handlers.js' %}"></script>
<script src="{% static 'scripts/offerButton.js' %}"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@glidejs/glide/dist/css/glide.core.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/@glidejs/glide/dist/glide.min.js"></script>
<script src="{% static 'scripts/tumbnailActiveElCarousel.js' %}"></script>

    
{% endblock %}