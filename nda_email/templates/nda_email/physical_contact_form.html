<script src="https://smartcaptcha.yandexcloud.net/captcha.js" defer></script> 

<form
    id="physical_modal_form"
    enctype="multipart/form-data"
    hx-post="{% url 'physical_cart_submit' %}?random={{ timestamp }}%}"
    hx-target="#physical_modal_form_container"  
    hx-swap="innerHTML"                     
    novalidate
>
    {% csrf_token %}
   <div id="physical_modal_form_container"> 
    <div class="physicalForm">
        <div class="formEl">
            <div class="form-floating mb-3">
                {{ p_contact_form.name }}
                <label for="fullNameLegal">ФИО контактного лица5</label>
            </div>
            <div class="oneLine">
                <div class="form-floating mb-3 w-50">
                    {{ p_contact_form.phone_number }}
                    <label for="validationPhoneNumber">Номер телефона</label>
                    {% if p_contact_form.phone_number.errors %}
                        <div style="color: red">
                            {{ p_contact_form.phone_number.errors }}
                        </div>
                    {% endif %}
                </div>
                <div class="form-floating mb-3 w-50">
                    {{ p_contact_form.email }}
                     {% if p_contact_form.email.errors %}
                        <span class="invalid-feedback">
                            {{ p_contact_form.email.errors }}
                        </span>
                    {% endif %}
                    <label for="email">Email</label>
                </div>
            </div>
            <div class="form-floating mb-3">
                {{ p_contact_form.message }}
                <label for="message">Комментарий к заказу</label>
            </div>
             <div class="mb-3">
                <label class="input-file">
                    {{p_contact_form.company_details}}
                    <span>Прикрепить файл</span>
                </label>
            </div>
            
            <div
                id="captcha-container"
                class="smart-captcha mb-3"
                data-sitekey="ysc1_sxny6cNZmnvhyJKrojDDLNxj0nvkGnTleldHzqEo9d9475ca"
            >
            </div>
            {% if captchaError %}
                <div class="text-danger mb-3">{{ captchaError }}</div>
            {% endif %}
        
            
            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="policyCheckLegal" required />
                <label class="form-check-label" for="policyCheckLegal">Я прочитал(а) уведомление о <a href='{% url "privacy" %}'>политике конфиденциальности</a></label>
            </div>
            {% if emailError %}
                <div class="text-danger mb-3">{{ emailError }}</div>
            {% endif %}
             {% if emailSuccess %}
                <div class="text-success mb-3">{{ emailSuccess }}</div>
            {% endif %}
            <div class="modal-footer">
                <button type="submit" form="physical_modal_form" class="btn btn-primary">Отправить запрос</button>
            </div>
        </div>
    </div>
   </div>
</form>

<script>
    function initSmartCaptcha() {
        var captchaContainer = document.getElementById('captcha-container');
        if (captchaContainer && !captchaContainer.hasChildNodes()){
           console.log('initialize')
           var sitekey = captchaContainer.getAttribute('data-sitekey');
           var smartCaptcha = new window.SmartCaptcha(captchaContainer, sitekey);
           } else {
             console.log('initialized');
           }
    }
    initSmartCaptcha()
</script>